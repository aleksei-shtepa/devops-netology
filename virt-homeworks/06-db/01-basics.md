# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

---

> - Электронные чеки в json виде

NoSQL, документо-ориентированная СУБД. Электронные чеки - это неизменяемые во времени данные, содержащие переменное количество однотипных полей, то есть представляет собой документ.

> - Склады и автомобильные дороги для логистической компании

NoSQL, графовая СУБД. Логистической компании необходимы данные для оптимального хранения и транспортировки товарных запасов. Склады будут узлами графа, а дороги его рёбрами. Для Каждого ребра можно будет добавлять свойства.

> - Генеалогические деревья

Если бы задача стояла хранить генеалогическое дерево по мужской линии, то подошёл бы иерархический тип СУБД. У каждого потомка был бы один родитель.

Если же наше генеалогическое дерево предполагает хранение данных по обоим линиям, что на мой взгляд более интересно, то у каждого потомка необходимо сохранять два родителя. Это уже похоже на сетевой тип СУБД.

Так же может подойти и графовый тип СУБД. Узлами будут представлены люди, а рёбрами - их степени родства.

> - Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутентификации

NoSQL, ключ-значение. Ключом будет идентификатор клиента, значением - данные аутентификации.

> - Отношения клиент-покупка для интернет-магазина

Множественные отношения клиент-покупка-товар лучше размещать в реляционной СУБД чтобы избежать дублирования данных (избыточности).

С другой стороны, если мы хотим получить большую производительность можно добавить избыточности в данные и хранить данные о покупках одного пользователя в виде документа. Данные о товаре так же можно сохранить в виде документа. В этом варианте применима документо-ориентированная СУБД.

## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

---

> - Данные записываются на все узлы с задержкой до часа (асинхронная запись)

**AP**. В рамках теоремы CAP, система считается доступной (Availability) так как все данные будут записаны. При этом система подразумевает работу в сегментированном виде (Partition tolerance). Но согласованности данных в течении этого часа нет.

**PA/EC**. В рамках теоремы PACELC, для системы важна высокая доступность узлов и конечная согласованность данных с допустимой задержкой.

> - При сетевых сбоях, система может разделиться на 2 раздельных кластера

**AP**. При разделе на два кластера будет несогласованность данным между этими кластерами. Раздел на два кластера подразумевает наличие свойства (Partition tolerance). Каждый из кластеров будет предоставлять отклик (Availability).

**PA/EL**. Для данной реализации важна высокая доступность узлов в режиме разделения и низкая задержка ответа в нормальном режиме.

> - Система может не прислать корректный ответ или сбросить соединение

**CP** или **C**. Клиент может не получить отклик на свой запрос, значит отсутствует свойство доступности (Availability). Следовательно, по теореме CAP, система может обладать свойствами согласованности и, возможно, устойчивости к разделению. Но может и не иметь возможности Partition tolerance - не достаточно условий в задаче.

**PC/EC**. Данная реализация ближе всего к принципам ACID, стремится быть согласованной как в нормальном режиме, так и в режиме разделения.

## Задача 3

> Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

Принципы **BASE** и **ACID** описывают разные подходы к надёжности и производительности в отношении работы с данными.

**ACID** предполагает более строгие требования к надёжности данных (их согласованности), а **BASE** к времени доступа к данным (производительности).

Усиливать одно можно только жертвуя другим. Поэтому принципы **BASE** и **ACID** не могут одновременно сочетаться в одной системе. Собственно об этом и говорит теорема **CAP**.

## Задача 4

> Вам дали задачу написать системное решение, основой которого бы послужили:
>
> - фиксация некоторых значений с временем жизни
> - реакция на истечение таймаута
>
> Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). Что это за система? Какие минусы выбора данной системы?

Мне известно только одно решение сочетающее в себе как хранилище `ключ-значение` с определённым временем жизни значений, так и брокера сообщений - это [Redis](https://redis.io/).

Особенностью данной системы является хранение данных в оперативной памяти. Что в случае сбоев и падения приведёт к потере данных. Нивелировать эти негативные последствия можно применением кластера Redis, что в свою очередь повышает требования к квалификации обслуживающего персонала.
